<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="content-type" content="text/html;charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>bookmarks</title>
  </head>
  <body>
    <div id="app"></div>
    <script>(function(){
    function appendEl(tag, key, val) {
        var el = document.createElement(tag)
        el[key] = val
        document.body.appendChild(el)
        return el
    }
    function checkStatus(res) {
        var status = res.status
        if (status < 200 || status > 299)
            throw status
        
        return res.text()
    }
    var protocol = window.location.protocol,
        http = 0 === protocol.indexOf('http'),
        hostname = http ? window.location.hostname : '127.0.0.1',
        master_ip = window.master_ip,
        master_prefix = '//' + (master_ip || hostname) + ':5010',
        slave_prefix = '//' + hostname + (master_ip ? ':5010' : ':5015'),
        rpc_config_d,
        uri_w_map
    
    window.rpc_host = http ? protocol : 'http:'
    window.rpc_config = {
        get$$: function(uri, opts) {
            if (!rpc_config_d) rpc_config_d = window['rpc_config_d']
            
            var prefix = uri_w_map[uri] ? master_prefix : slave_prefix
            return rpc_config_d.get$$(prefix + uri, opts)
        },
        post$$: function(uri, data) {
            if (!rpc_config_d) rpc_config_d = window['rpc_config_d']
            
            var prefix = uri_w_map[uri] ? master_prefix : slave_prefix
            return rpc_config_d.post$$(prefix + uri, data)
        }
    }
    window.fetch || appendEl('script', 'src', '/assets/js/fetch.min.js')
    window.fetch('g/user/w/UserServices.json').then(checkStatus).then(function(data) {
        uri_w_map = JSON.parse(data)
        appendEl('script', 'src', 'dist/build.js')
    })
    })();</script>
    <link rel="stylesheet" href="dist/app.css" />
  </body>
</html>
